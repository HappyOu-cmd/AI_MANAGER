# Архитектура AI Manager

## Структура проекта

```
ai-manager/
├── app/                          # Основное приложение Flask
│   ├── __init__.py              # Factory функция для создания приложения
│   ├── config.py                # Конфигурация (dev/prod/test)
│   ├── routes/                  # Маршруты (Blueprints)
│   │   ├── __init__.py
│   │   ├── main.py              # Главная страница, health check
│   │   ├── upload.py             # Загрузка и обработка файлов
│   │   └── download.py           # Скачивание результатов
│   ├── services/                 # Бизнес-логика
│   │   ├── __init__.py
│   │   ├── document_service.py   # Полная обработка документа
│   │   └── ai_service.py         # Работа с AI провайдерами
│   ├── models/                   # Модели данных (будущее расширение)
│   │   └── __init__.py
│   ├── utils/                    # Утилиты
│   │   ├── __init__.py
│   │   ├── validators.py         # Валидация файлов
│   │   ├── exceptions.py         # Кастомные исключения
│   │   └── error_handlers.py     # Обработчики ошибок Flask
│   └── core/                     # Ядро приложения
│       ├── __init__.py
│       ├── converters/           # Конвертеры документов
│       │   ├── __init__.py
│       │   ├── base.py           # Базовый класс
│       │   └── document.py        # Универсальный конвертер
│       ├── ai/                    # AI клиенты
│       │   ├── __init__.py
│       │   ├── base.py            # Базовый интерфейс
│       │   ├── openai_client.py   # OpenAI клиент
│       │   └── jayflow_client.py  # JayFlow клиент
│       ├── builders/              # Построители
│       │   ├── __init__.py
│       │   └── prompt_builder.py  # Построитель промптов
│       └── exporters/             # Экспортеры
│           ├── __init__.py
│           └── json_to_excel.py   # Конвертер JSON → Excel
├── data/                          # Данные (шаблоны, глоссарии)
│   ├── Промпт.txt
│   ├── TZ.json
│   └── glossary.json
├── storage/                       # Хранилище файлов
│   ├── uploads/                   # Загруженные файлы
│   ├── converted/                 # Сконвертированные файлы
│   ├── results/                   # Результаты обработки
│   └── debug/                     # Отладочные файлы
├── logs/                          # Логи приложения
├── templates/                     # HTML шаблоны
│   └── index.html
├── static/                        # Статические файлы
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── main.js
├── tests/                         # Тесты (будущее расширение)
├── run.py                         # Точка входа для запуска
├── requirements.txt               # Зависимости
└── .gitignore
```

## Принципы архитектуры

### 1. Разделение ответственности
- **Routes** - только обработка HTTP запросов
- **Services** - бизнес-логика
- **Core** - переиспользуемые компоненты
- **Utils** - вспомогательные функции

### 2. Расширяемость
- Базовые классы для конвертеров и AI клиентов
- Легко добавить новые провайдеры ИИ
- Легко добавить новые форматы документов
- Легко добавить новые экспортеры

### 3. Конфигурация
- Разные конфигурации для dev/prod/test
- Все пути и настройки в одном месте
- Поддержка переменных окружения

### 4. Обработка ошибок
- Кастомные исключения
- Централизованные обработчики
- Логирование всех ошибок

## Как добавить новый компонент

### Добавить новый AI провайдер:
1. Создать класс в `app/core/ai/new_provider.py`
2. Наследовать от `BaseAIClient`
3. Реализовать методы `process_prompt()` и `get_model_name()`
4. Добавить в `app/services/ai_service.py`

### Добавить новый формат документа:
1. Добавить метод в `app/core/converters/document.py`
2. Обновить `SUPPORTED_FORMATS`
3. Добавить в `ALLOWED_EXTENSIONS` в конфигурации

### Добавить новый маршрут:
1. Создать файл в `app/routes/`
2. Создать Blueprint
3. Зарегистрировать в `app/__init__.py`

## Запуск

### Разработка:
```bash
python run.py
# или
FLASK_ENV=development python run.py
```

### Продакшен:
```bash
FLASK_ENV=production gunicorn -w 3 -b 127.0.0.1:5000 run:app
```

