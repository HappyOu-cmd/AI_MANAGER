<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–ò –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¢–ó</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
    <button class="menu-toggle" id="menuToggle" style="display: none;">‚ò∞</button>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">ü§ñ</div>
                <div class="sidebar-logo-text">–ò–ò –ú–µ–Ω–µ–¥–∂–µ—Ä</div>
            </div>
            <div class="sidebar-subtitle">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¢–ó</div>
        </div>
        
        <nav class="sidebar-nav">
            {% if current_user.is_authenticated %}
            <a href="/" class="sidebar-nav-item active">
                <span class="sidebar-nav-item-icon">üìÑ</span>
                <span>–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</span>
            </a>
            <a href="/history" class="sidebar-nav-item">
                <span class="sidebar-nav-item-icon">üìö</span>
                <span>–ú–æ–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã</span>
            </a>
            {% if current_user.is_admin %}
            <a href="/admin" class="sidebar-nav-item">
                <span class="sidebar-nav-item-icon">‚öôÔ∏è</span>
                <span>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</span>
            </a>
            <a href="/logs" class="sidebar-nav-item">
                <span class="sidebar-nav-item-icon">üìä</span>
                <span>–õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
            </a>
            {% endif %}
            <a href="/scenarios" class="sidebar-nav-item">
                <span class="sidebar-nav-item-icon">‚öôÔ∏è</span>
                <span>–°—Ü–µ–Ω–∞—Ä–∏–∏</span>
            </a>
            {% endif %}
        </nav>
        
        <div class="sidebar-footer">
            {% if current_user.is_authenticated %}
            <div class="sidebar-user-info">
                <div class="sidebar-user-name">{{ current_user.username }}</div>
                {% if current_user.is_admin %}
                <div class="sidebar-user-role">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                {% endif %}
                <a href="/auth/logout" class="sidebar-logout">–í—ã–π—Ç–∏</a>
            </div>
            {% endif %}
            <div class="sidebar-footer-text">–ò–ò –ú–µ–Ω–µ–¥–∂–µ—Ä v1.0</div>
        </div>
    </aside>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="main-content">
        <div class="container">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            <div class="page-header">
                <h1>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è</h1>
                <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –¢–ó —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
            </div>

            {% if require_login %}
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ö–æ–¥–∞ -->
            <div class="card" style="text-align: center; padding: 48px;">
                <div style="font-size: 64px; margin-bottom: 16px;">üîê</div>
                <h2 style="margin-bottom: 16px;">–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <p style="color: var(--text-light); margin-bottom: 24px;">–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                <div style="display: flex; gap: 16px; justify-content: center;">
                    <a href="/auth/login" class="btn btn-primary">–í–æ–π—Ç–∏</a>
                    <a href="/auth/register" class="btn btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                </div>
            </div>
            {% else %}
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div class="card upload-card">
                <div class="card-header">
                    <div class="card-icon">üì§</div>
                    <div class="card-title">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</div>
                </div>

                <form id="uploadForm" enctype="multipart/form-data">
                    <!-- –û–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon-large">üìÑ</div>
                        <div class="upload-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                        <div class="upload-formats">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOC, DOCX, XLS, XLSX, TXT</div>
                        <input type="file" id="fileInput" name="file" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt" required style="display: none;">
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                        </button>
                        <div id="fileName" style="margin-top: 12px; font-size: 14px; color: var(--text-light);">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
                    </div>

                    <!-- –í—ã–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è -->
                    <div class="form-group">
                        <label class="form-label" for="scenarioSelect">
                            <span>üìã</span>
                            <span>–°—Ü–µ–Ω–∞—Ä–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</span>
                        </label>
                        <select id="scenarioSelect" name="scenario_id" class="form-select" required>
                            {% for scenario in scenarios %}
                            <option value="{{ scenario.id }}" {% if scenario.id == 'tokarny_default' %}selected{% endif %}>
                                {{ scenario.name }} ({{ scenario.machine_type }})
                            </option>
                            {% endfor %}
                        </select>
                        <a href="/scenarios" class="form-link">
                            <span>‚öôÔ∏è</span>
                            <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏</span>
                        </a>
                    </div>

                    <!-- –í—ã–±–æ—Ä AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ -->
                    <div class="form-group">
                        <label class="form-label" for="aiProvider">
                            <span>ü§ñ</span>
                            <span>AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä</span>
                        </label>
                        <select id="aiProvider" name="ai_provider" class="form-select">
                            <option value="openai">OpenAI (GPT-5)</option>
                            <option value="jayflow">Jay Flow</option>
                        </select>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button type="submit" class="btn btn-primary" id="submitBtn" style="flex: 1;">
                            <span class="btn-text">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –ò–ò</span>
                            <span class="loader" id="loader" style="display: none;">‚è≥</span>
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelBtn" style="display: none;" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É">
                            ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>

                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
                    <div class="progress-container" id="progressSteps" style="display: none;">
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <div class="progress-text" id="statusMessage">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
                        
                        <div class="progress-steps">
                            <div class="step" id="step_conversion">
                                <div class="step-icon">üìÑ</div>
                                <div class="step-text">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...</div>
                            </div>
                            <div class="step" id="step_main">
                                <div class="step-icon">ü§ñ</div>
                                <div class="step-text">–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞...</div>
                            </div>
                            <div class="step" id="step_instrument" style="display: none;">
                                <div class="step-icon">üîß</div>
                                <div class="step-text">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞...</div>
                            </div>
                            <div class="step" id="step_tooling" style="display: none;">
                                <div class="step-icon">‚öôÔ∏è</div>
                                <div class="step-text">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Å–Ω–∞—Å—Ç–∫–∏...</div>
                            </div>
                            <div class="step" id="step_services" style="display: none;">
                                <div class="step-icon">üíº</div>
                                <div class="step-text">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É—Å–ª—É–≥...</div>
                            </div>
                            <div class="step" id="step_spare_parts" style="display: none;">
                                <div class="step-icon">üì¶</div>
                                <div class="step-text">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ó–ò–ü...</div>
                            </div>
                        </div>
                        
                        <div class="metrics-card" id="metricsBox" style="display: none;">
                            <div class="metrics-title">
                                <span>üìä</span>
                                <span>–ú–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏</span>
                            </div>
                            <div id="metricsContainer"></div>
                        </div>
                    </div>
                </form>
            </div>
            {% endif %}

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="card result-card" id="resultSection" style="display: none;">
                <div class="result-icon-large">‚úÖ</div>
                <div class="result-title">–¢–ó —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ!</div>
                <p id="resultMessage" style="color: var(--text-light); margin-bottom: 24px;"></p>
                
                <div class="file-info-card" id="fileInfo"></div>
                
                <div class="download-buttons" id="downloadButtons">
                    <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –û—à–∏–±–∫–∏ -->
            <div class="card error-card" id="errorBox" style="display: none;">
                <div class="error-icon-large">‚ùå</div>
                <div class="error-title">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
                <p id="errorMessage" style="color: var(--text-light);"></p>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
            <div class="card info-card">
                <div class="card-header">
                    <div class="card-icon">‚ÑπÔ∏è</div>
                    <div class="card-title">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã</div>
                </div>
                
                <div class="info-grid">
                        <div class="info-item">
                            <div class="info-item-title">PDF</div>
                            <div class="info-item-text">–ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –≤–µ—Å—å —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-title">Word (DOCX/DOC)</div>
                            <div class="info-item-text">–¢–µ–∫—Å—Ç –∏ —Ç–∞–±–ª–∏—Ü—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-title">Excel (XLS/XLSX)</div>
                            <div class="info-item-text">–í—Å–µ –ª–∏—Å—Ç—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-title">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä</div>
                            <div class="info-item-text">–î–æ 50 –ú–ë –Ω–∞ —Ñ–∞–π–ª</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
